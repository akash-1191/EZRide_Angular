<div class="p-6 bg-gray-50 min-h-screen">

    <h2 class="text-2xl font-bold text-gray-800 mb-6">
        <i class="fas fa-money-check-alt mr-2 text-green-600"></i>
        Paid Driver Payments
    </h2>

    <!-- Loading -->
    <div *ngIf="isLoading" class="text-center py-10">
        <i class="fas fa-spinner fa-spin text-3xl text-blue-600"></i>
    </div>

    <!-- Error -->
    <div *ngIf="errorMessage" class="bg-red-100 text-red-700 p-4 rounded mb-4">
        {{ errorMessage }}
    </div>

    <!-- No Data -->
    <div *ngIf="!isLoading && payments.length === 0" class="text-center text-gray-600">
        No paid driver payments found
    </div>

    <!-- Table -->
    <div *ngIf="payments.length > 0" class="overflow-x-auto bg-white rounded-lg shadow">
        <table class="min-w-full border border-gray-200">
            <thead class="bg-gray-100 text-gray-700 text-sm">
                <tr>
                    <th class="p-3 text-left">Driver</th>
                    <th class="p-3 text-left">Phone</th>
                    <th class="p-3 text-left">Trip Time</th>
                    <th class="p-3 text-left">Amount</th>
                    <th class="p-3 text-left">Payment Date</th>
                    <th class="p-3 text-left">Status</th>
                    <th class="p-3 text-left">Action</th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let item of payments" class="border-t hover:bg-gray-50">

                    <!-- Driver -->
                    <td class="p-3 font-semibold">
                        {{ item.driver.driverName }}
                        <div class="text-xs text-gray-500">{{ item.driver.driverEmail }}</div>
                    </td>

                    <!-- Phone -->
                    <td class="p-3">{{ item.driver.driverPhone }}</td>
                    <!-- Trip -->
                    <td class="p-3 text-sm">
                        {{ formatDate(item.booking.startTime) }} <br>
                        <span class="text-gray-500">to</span><br>
                        {{ formatDate(item.booking.endTime) }}
                    </td>
                    <!-- Amount -->
                    <td class="p-3 font-bold text-green-600">
                        ₹{{ item.driverPayment.amount }}
                    </td>

                    <!-- Payment Date -->
                    <td class="p-3 text-sm">
                        {{ formatDate(item.driverPayment.paidAt) }}
                    </td>

                    <!-- Status -->
                    <td class="p-3">
                        <span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs">
                            Paid
                        </span>
                    </td>

                    <!-- Action -->
                    <td class="p-3">
                        <i class="fas fa-arrow-circle-right text-blue-600 cursor-pointer text-xl hover:text-blue-800 transition"
                            (click)="openPaymentModal(item)">
                        </i>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- ================= MODAL ================= -->
<!-- MODAL BACKDROP -->
<div *ngIf="isModalOpen" class="fixed inset-0 bg-black/30 bg-opacity-50 flex items-center justify-center z-50">

    <div class="bg-white w-full max-w-2xl rounded-xl shadow-lg p-6 relative">

        <!-- CLOSE BUTTON -->
        <button (click)="isModalOpen = false"
            class="absolute top-3 right-3 cursor-pointer text-gray-500 hover:text-red-500 text-xl">
            ✕
        </button>

        <!-- HEADER -->
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="fa-solid fa-file-invoice-dollar text-blue-600"></i>
            Driver Payment Details
        </h3>

        <!-- DRIVER INFO -->
        <div class="border rounded-lg p-4 mb-4 bg-gray-50">
            <h4 class="font-semibold text-gray-700 mb-2">
                <i class="fa-solid fa-user text-indigo-500 mr-1"></i>
                Driver Information
            </h4>

            <div class="grid grid-cols-2 gap-3 text-sm">
                <div><span class="font-medium">Name:</span> {{ selectedPayment.driver.driverName }}</div>
                <div><span class="font-medium">Phone:</span> {{ selectedPayment.driver.driverPhone }}</div>
                <div class="col-span-2">
                    <span class="font-medium">Email:</span> {{ selectedPayment.driver.driverEmail }}
                </div>
            </div>
        </div>

        <!-- BOOKING INFO -->
        <div class="border rounded-lg p-4 mb-4">
            <h4 class="font-semibold text-gray-700 mb-2">
                <i class="fa-solid fa-car text-green-600 mr-1"></i>
                Booking Information
            </h4>

            <div class="grid grid-cols-2 gap-3 text-sm">
                <div>
                    <span class="font-medium">Start Time:</span><br>
                    {{ formatDate(selectedPayment.booking.startTime) }}
                </div>
                <div>
                    <span class="font-medium">End Time:</span><br>
                    {{ formatDate(selectedPayment.booking.endTime) }}
                </div>
                <div>
                    <span class="font-medium">Status:</span>
                    <span class="ml-1 px-2 py-1 text-xs rounded-full bg-green-100 text-green-700">
                        {{ selectedPayment.booking.status }}
                    </span>
                </div>
            </div>
        </div>

        <!-- PAYMENT INFO -->
        <div class="border rounded-lg p-4 bg-gray-50">
            <h4 class="font-semibold text-gray-700 mb-2">
                <i class="fa-solid fa-money-bill-wave text-emerald-600 mr-1"></i>
                Payment Information
            </h4>

            <div class="grid grid-cols-2 gap-3 text-sm">
                <div>
                    <span class="font-medium">Amount:</span>
                    <span class="text-green-600 font-bold ml-1">
                        ₹{{ selectedPayment.driverPayment.amount }}
                    </span>
                </div>

                <div>
                    <span class="font-medium">Payment Type:</span>
                    {{ selectedPayment.driverPayment.paymentType }}
                </div>

                <div>
                    <span class="font-medium">Paid At:</span><br>
                    {{ formatDate(selectedPayment.driverPayment.paidAt) }}
                </div>

                <div>
                    <span class="font-medium">Status:</span>
                    <span class="ml-1 px-2 py-1 text-xs rounded-full bg-green-100 text-green-700">
                        {{ selectedPayment.driverPayment.status }}
                    </span>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="mt-6 text-right">
            <button (click)="isModalOpen = false"
                class="px-4 py-2 bg-blue-600 cursor-pointer text-white rounded hover:bg-blue-700">
                Close
            </button>
        </div>

    </div>
</div>