<div class="container mx-auto p-4 space-y-10">


  <!-- VEHICLE SELECTION DROPDOWN -->
<!-- Remove Confirmation Modal -->
<div *ngIf="showRemoveConfirmation" class="fixed inset-0 bg-black/30 bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-md mx-4">
    <h3 class="text-lg font-semibold text-gray-800 mb-3">Remove Vehicle</h3>
    <p class="text-gray-600 mb-4">
      Remove <span class="font-semibold">{{vehicleToRemove}}</span> from recent selections?
    </p>
    <div class="flex justify-end gap-3">
      <button (click)="cancelRemove()"
              class="px-4 py-2 border border-gray-300 rounded hover:bg-gray-50">
        Cancel
      </button>
      <button (click)="confirmRemove()"
              class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
        Remove
      </button>
    </div>
  </div>
</div>

<!-- VEHICLE SELECTION DROPDOWN -->
<div class="bg-white shadow-md rounded-lg p-4">
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
    
    <!-- Left: Vehicle Selection -->
    <div class="md:w-2/3">
      <label class="block text-sm font-medium text-gray-700 mb-1">
        <i class="fas fa-car mr-2"></i>Select Vehicle Number
      </label>
      
      <div class="flex gap-2">
        <!-- Searchable Dropdown Container -->
        <div class="flex-1 relative">
          <!-- Search Input -->
          <div *ngIf="showVehicleSearch" class="mb-2">
            <input type="text" 
                   [(ngModel)]="vehicleSearchText"
                   (input)="filterVehicleOptions()"
                   placeholder="Search vehicle number..."
                   class="w-full px-3 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-green-500">
          </div>
          
          <!-- Dropdown for all vehicle numbers -->
          <select [(ngModel)]="selectedVehicleNo" 
                  (change)="applyFilter()"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
            
            <!-- Show All Option -->
            <option value="all">ðŸ“‹ Show All Vehicles</option>
            
            <!-- Separator -->
            <option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
            
            <!-- All Vehicle Numbers (Filtered) -->
            <option *ngFor="let vehicleNo of filteredVehicleNumbers" [value]="vehicleNo">
              ðŸš— {{vehicleNo}}
            </option>
            
            <!-- Empty state -->
            <option *ngIf="filteredVehicleNumbers.length === 0" disabled>
              {{vehicleSearchText ? 'No vehicles found for "' + vehicleSearchText + '"' : 'No vehicles found'}}
            </option>
          </select>
          
          <!-- Search Toggle Button -->
          <button (click)="toggleVehicleSearch()"
                  class="absolute right-10 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
            <i class="fas fa-search text-sm"></i>
          </button>
        </div>
        
        <!-- Show All Button -->
        <button (click)="showAllVehicles()"
                class="bg-blue-100 text-blue-800 px-4 py-2 rounded-md hover:bg-blue-200 transition whitespace-nowrap">
          <i class="fas fa-list mr-1"></i>Show All
        </button>
      </div>
      
      <!-- Quick Stats -->
      <div class="flex items-center gap-4 mt-2">
        <span class="text-xs text-gray-500">
          <i class="fas fa-database mr-1"></i>
          Total: <span class="font-semibold">{{allVehicleNumbers.length}}</span>
        </span>
        <span class="text-xs text-gray-500">
          <i class="fas fa-eye mr-1"></i>
          Showing: <span class="font-semibold">{{activePayments.length + deactivePayments.length}}</span>
        </span>
        <span class="text-xs text-gray-500">
          <i class="fas fa-filter mr-1"></i>
          Filter: <span class="font-semibold">{{selectedVehicleNo === 'all' ? 'All' : selectedVehicleNo}}</span>
        </span>
      </div>
    </div>
    
    <!-- Right: Totals Summary -->
    <div class="md:w-1/3">
      <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
        <div class="flex items-center justify-between mb-2">
          <h4 class="text-sm font-medium text-gray-700">
            <i class="fas fa-chart-pie mr-1"></i>Summary
          </h4>
          <button (click)="refreshData()" 
                  class="text-xs text-blue-600 hover:text-blue-800">
            <i class="fas fa-redo"></i>
          </button>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <div class="text-center p-2 bg-green-50 rounded border border-green-100">
            <div class="text-green-700 font-bold text-lg">{{activePayments.length}}</div>
            <div class="text-xs text-gray-600">Active</div>
            <div class="text-xs text-green-600 font-semibold mt-1">
              â‚¹{{calculateTotalActive() | number:'1.0-0'}}
            </div>
          </div>
          <div class="text-center p-2 bg-red-50 rounded border border-red-100">
            <div class="text-red-700 font-bold text-lg">{{deactivePayments.length}}</div>
            <div class="text-xs text-gray-600">Expired</div>
            <div class="text-xs text-red-600 font-semibold mt-1">
              â‚¹{{calculateTotalDeactive() | number:'1.0-0'}}
            </div>
          </div>
        </div>
        <div class="mt-2 pt-2 border-t border-gray-200">
          <div class="flex justify-between text-xs">
            <span class="text-gray-600">Grand Total:</span>
            <span class="font-semibold">
              â‚¹{{calculateTotalActive() + calculateTotalDeactive() | number:'1.0-0'}}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- RECENT SELECTIONS WITH REMOVE BUTTONS -->
  <div *ngIf="recentSelections.length > 0" class="mt-4">
    <div class="flex items-center justify-between mb-2">
      <label class="text-xs font-medium text-gray-700">
        <i class="fas fa-history mr-1"></i>Recent Selections:
      </label>
      <button (click)="clearAllRecent()"
              class="text-xs text-red-600 hover:text-red-800">
        <i class="fas fa-trash-alt mr-1"></i>Clear All
      </button>
    </div>
    
    <div class="flex flex-wrap gap-2">
      <div *ngFor="let vehicleNo of recentSelections" 
           class="group relative">
        
        <!-- Vehicle Chip with Remove Button -->
        <div class="flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm hover:bg-blue-200 transition-all duration-200">
          
          <!-- Vehicle Number (Click to Select) -->
          <button (click)="selectVehicle(vehicleNo)"
                  class="pr-1 hover:text-blue-900">
            {{vehicleNo}}
          </button>
          
          <!-- Remove Button (X) -->
          <button (click)="removeFromRecentSelections(vehicleNo, $event)"
                  class="ml-1 text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
            <i class="fas fa-times text-xs"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- VEHICLE STATS -->
  <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-3">
    <div class="bg-gray-50 p-3 rounded border">
      <div class="text-xs text-gray-500 mb-1">Selected Vehicle</div>
      <div class="font-mono font-bold text-lg truncate">
        {{selectedVehicleNo === 'all' ? 'ALL VEHICLES' : selectedVehicleNo}}
      </div>
    </div>
    
    <div class="bg-blue-50 p-3 rounded border border-blue-100">
      <div class="text-xs text-blue-600 mb-1">Active Amount</div>
      <div class="font-bold text-blue-700 text-lg">
        â‚¹{{calculateTotalActive() | number:'1.0-0'}}
      </div>
    </div>
    
    <div class="bg-red-50 p-3 rounded border border-red-100">
      <div class="text-xs text-red-600 mb-1">Expired Amount</div>
      <div class="font-bold text-red-700 text-lg">
        â‚¹{{calculateTotalDeactive() | number:'1.0-0'}}
      </div>
    </div>
    
    <div class="bg-purple-50 p-3 rounded border border-purple-100">
      <div class="text-xs text-purple-600 mb-1">Total Records</div>
      <div class="font-bold text-purple-700 text-lg">
        {{activePayments.length + deactivePayments.length}}
      </div>
    </div>
  </div>
</div>

  <!-- ACTIVE VEHICLE PAYMENTS -->
<div class="bg-white shadow-md rounded-lg overflow-x-auto">
    <h2 class="text-xl font-semibold text-green-700 px-4 py-3 border-b">
        <i class="fas fa-check-circle text-green-600"></i> Active Vehicles
    </h2>

    <table class="min-w-full text-sm text-left text-gray-700">
        <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
            <tr>
                <th class="px-4 py-3">Owner</th>
                <th class="px-4 py-3">RegistrationNo</th>
                <th class="px-4 py-3">Start</th>
                <th class="px-4 py-3">End</th>
                <th class="px-4 py-3">Days</th>
                <th class="px-4 py-3">Price/Day</th>
                <th class="px-4 py-3">Total</th>
                <th class="px-4 py-3">Status</th>
                <th class="px-4 py-3 text-center">Pay</th>
            </tr>
        </thead>

        <tbody>

            <!-- No Data Message -->
            <tr *ngIf="activePayments.length === 0">
                <td colspan="9" class="text-center py-4 text-gray-500">
                    No Active Vehicle Payments Found
                </td>
            </tr>

            <!-- Active Rows -->
            <tr *ngFor="let item of activePayments" class="border-t hover:bg-green-50 transition">

                <td class="px-4 py-3">{{ item.ownerName }}</td>
                <td class="px-4 py-3">{{ item.registrationNo }}</td>
                <td class="px-4 py-3">{{ item.startDate | date }}</td>
                <td class="px-4 py-3">{{ item.endDate | date }}</td>
                <td class="px-4 py-3">{{ item.totalDays }}</td>
                <td class="px-4 py-3">â‚¹{{ item.vehicleAmountPerDay }}</td>
                <td class="px-4 py-3 font-semibold">â‚¹{{ item.totalAmount }}</td>
                <td class="px-4 py-3 text-green-600 font-semibold">
                    {{ item.status }}
                </td>
                <td class="px-4 py-3 text-center">
                    <button (click)="payNow(item)"
                        class="bg-green-600 cursor-pointer text-white px-3 py-1 rounded hover:bg-green-700 transition">
                        Pay
                    </button>
                </td>

            </tr>

        </tbody>
    </table>
</div>


<!-- DEACTIVE VEHICLE PAYMENTS -->
<div class="bg-white shadow-md rounded-lg overflow-x-auto">
    <h2 class="text-xl font-semibold text-red-700 px-4 py-3 border-b">
        <i class="fas fa-times-circle text-red-600"></i> Deactive Vehicles
    </h2>

    <table class="min-w-full text-sm text-left text-gray-700">
        <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
            <tr>
                <th class="px-4 py-3">Owner</th>
                <th class="px-4 py-3">RegistrationNo</th>
                <th class="px-4 py-3">Start</th>
                <th class="px-4 py-3">End</th>
                <th class="px-4 py-3">Days</th>
                <th class="px-4 py-3">Price/Day</th>
                <th class="px-4 py-3">Total</th>
                <th class="px-4 py-3">Status</th>
                <th class="px-4 py-3 text-center">Pay</th>
            </tr>
        </thead>

        <tbody>

            <!-- No Data Message -->
            <tr *ngIf="deactivePayments.length === 0">
                <td colspan="9" class="text-center py-4 text-gray-500">
                    No Deactive Vehicle Payments Found
                </td>
            </tr>

            <!-- Deactive Rows -->
            <tr *ngFor="let item of deactivePayments" class="border-t hover:bg-red-50 transition">

                <td class="px-4 py-3">{{ item.ownerName }}</td>
                <td class="px-4 py-3">{{ item.registrationNo }}</td>
                <td class="px-4 py-3">{{ item.startDate | date }}</td>
                <td class="px-4 py-3">{{ item.endDate | date }}</td>
                <td class="px-4 py-3">{{ item.totalDays }}</td>
                <td class="px-4 py-3">â‚¹{{ item.vehicleAmountPerDay }}</td>
                <td class="px-4 py-3 font-semibold">â‚¹{{ item.totalAmount }}</td>
                <td class="px-4 py-3 text-red-600 font-semibold">
                    {{ item.status }}
                </td>
                <td class="px-4 py-3 text-center ">
                    <button class="bg-gray-400  text-white px-3 py-1 rounded cursor-not-allowed">
                        Pay
                    </button>
                </td>
            </tr>
        </tbody>
    </table>
</div>

</div>